{
  "properties": {
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "actions": {
        "Error_Handler": {
          "actions": {
            "Notify_of_Error": {
              "inputs": {
                "body": {
                  "NotificationText": "@triggerOutputs()['headers']['x-ms-request-id']"
                },
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['shared_commondataserviceforapps']['connectionId']"
                  }
                },
                "method": "post",
                "path": "/v2/teams/actions/send-notification"
              },
              "runAfter": {},
              "type": "ApiConnection"
            }
          },
          "runAfter": {
            "Main_Process": [
              "Failed"
            ]
          },
          "type": "Scope"
        },
        "Main_Process": {
          "actions": {
            "Apply_to_each_record": {
              "actions": {
                "Update_Record": {
                  "inputs": {
                    "body": {
                      "field1": "@items('Apply_to_each_record')?['name']"
                    },
                    "host": {
                      "connection": {
                        "name": "@parameters('$connections')['shared_commondataserviceforapps']['connectionId']"
                      }
                    },
                    "method": "patch",
                    "path": "/v2/entities/@{encodeURIComponent('accounts')}/@{encodeURIComponent(items('Apply_to_each_record')['accountid'])}"
                  },
                  "runAfter": {},
                  "type": "ApiConnection"
                }
              },
              "foreach": "@body('List_records')?['value']",
              "runAfter": {
                "List_records": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "List_records": {
              "inputs": {
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['shared_commondataserviceforapps']['connectionId']"
                  }
                },
                "method": "get",
                "path": "/v2/entities/@{encodeURIComponent('accounts')}",
                "queries": {
                  "$filter": "statuscode eq 1",
                  "$select": "accountid,name"
                }
              },
              "runAfter": {},
              "type": "ApiConnection"
            }
          },
          "runAfter": {},
          "type": "Scope"
        }
      },
      "contentVersion": "1.0.0.0",
      "outputs": {},
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        }
      },
      "triggers": {
        "When_a_record_is_created_or_modified": {
          "inputs": {
            "host": {
              "connection": {
                "name": "@parameters('$connections')['shared_commondataserviceforapps']['connectionId']"
              }
            },
            "method": "get",
            "path": "/triggers/batch/entities/@{encodeURIComponent('accounts')}",
            "queries": {
              "triggerBody": {
                "entity_filter": "custom_solutions_managed",
                "filterExpression": "",
                "sorting": -1
              }
            }
          },
          "metadata": {
            "flowSystemMetadata": {
              "swaggerOperationId": "ListBatchTriggers"
            }
          },
          "type": "ApiConnectionWebhook"
        }
      }
    },
    "displayName": "[Flow Display Name]",
    "flowSuspensionReason": "None",
    "state": "Enabled"
  },
  "name": "[flow-logical-name]",
  "type": "Microsoft.Flow/flows"
}
